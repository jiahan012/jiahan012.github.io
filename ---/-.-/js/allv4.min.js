function game5s(e){var t=e;$(".countdown-box").css("display","none"),$(".bingo_line").css("display","none"),$("#game1-content").css("background-image","none"),$("#game1-content").css("background-color","#a9d1dd"),$("#game-notify-container").css("display","none"),$("header").css("display","none"),$("#game4StartPage").css("display","none"),$("#game5StartPage").css("display","block"),$("#game5StartBtn").on("click",function(){$("#game5StartPage").css("display","none"),$("#game5").css("display","block"),game5(t)})}function game5(e){for(var t=setInterval(";"),i=0;i<t;i++)clearInterval(i);logFile.push("第四關遊戲開始(a)\n"),logFileSimple.push("a"),db.ref(fullDbUrl+"Detail").push("第四關遊戲開始(a)");var o=e;$("#game5_score").text(o);var a=[{title:"It took a lot of time for Mary to take part in extracurricular activities so she could not devote herself to ______ great works for her PhD study."},{title:"This is _____ to the fact that her father and mother want to change her wrong attitudes toward her PhD."},{title:"All students do not want to make friends _____ Mary."},{title:"Mary _____ to have a book or magazine with her."},{title:"Mary has several hobbies, _____ playing digital games."},{title:"Digital games make Mary happier and help her not only have creative imagination _____ develop critical thinking."},{title:"Digital games are useful to neither creative imagination _____ critical thinking."},{title:"Mary _____ hot chocolate to milk."},{title:"Mary’s success _____home to people the fact that the future of work lies in learning."},{title:"It _____ without saying that Mary may be the laziest person that John has ever met"}],n={0:["do","doing","did","does",1],1:["owing","because","on account","face",0],2:["to","with","of","on",1],3:["used","is used","getting used","get used",0],4:["apart from","excepting","including","excluding",0],5:["but also","also","but","and",0],6:["nor","or","and","for",0],7:["prefer","prefers","like","likes",1],8:["brings","keeps","gives","goes",0],9:["goes","was","is","goes",0]},s=360;$("#qa_total").show();var l=1;$("#game5_topic").html(l);$("#qatotal").html(10);var r=0;$("#game5_bonus_count").text(r),$("#game5_hp_btn").attr("disabled",!0),$("#game5_time_btn").attr("disabled",!0);var p=100,m=0,u=a.length-1,c=n[String(m)][4],h=$(".start__title"),g=$(".start__boxman"),b=$(".start__startgame");TweenMax.from(h,1,{x:-600,y:-100,rotation:180,ease:Power3.easeOut,delay:.5}),TweenMax.from(g,1,{x:-500,ease:Power3.easeOut,delay:.5}),TweenMax.from(g,2,{y:"+=30px",ease:Power0.easeNone,repeat:-1,yoyo:!0,delay:.5}),TweenMax.from(b,1,{scale:0,ease:Bounce.easeOut,delay:.5}),b.on("click",function(t){t.preventDefault(),$(".start").fadeOut(100),function(){$(".game5_content").height();var t=m+1;$("#game5-notify-text").text("點擊中間下方圓形按鈕，控制角色飛行高度，於氣球前方近距離及同一水平線上，即可吸入。"),$(".game5_question").html('<h5 style="font-weight: 700;">'+t+". "+a[m].title+"</h5>"),logFile.push("第1題\n"),db.ref(fullDbUrl+"Detail").push("第1題"),TweenMax.to(".game5_content",15,{backgroundPositionX:"-1050px",ease:Linear.easeNone,repeat:-1});var i=function(e,t,i){this.size=e,this.position=t,this.$el=$(i),this.updateCss()};i.prototype.updateCss=function(){this.$el.css("left",this.position.x),this.$el.css("top",this.position.y),this.$el.css("width",this.size.width),this.$el.css("height",this.size.height)},i.prototype.collide1=function(e){var t=e.position.x+e.size.width>this.position.x+14&&e.position.x<this.position.x+this.size.width-14,i=e.position.y+e.size.height>this.position.y+12&&e.position.y<this.position.y+this.size.height-12;return t&&i},i.prototype.collide2=function(e){var t=e.position.x+e.size.width>=this.position.x-50&&e.position.x+e.size.width<this.position.x,i=e.position.y+e.size.height>this.position.y+12&&e.position.y<this.position.y+this.size.height-12;return t&&i};var h=function(e,t,o){i.call(this,e,t,o)};(h.prototype=Object.create(i.prototype)).constructor=h.constructor,h.prototype.update=function(){var e=$(".game5_content").height(),t=this.size.height;this.position.y<0&&(this.position.y=0),this.position.y+t>e&&(this.position.y=e-t),this.updateCss()};var g=new h({width:80,height:124},{x:10,y:200},".game__boxman");$("#boxman_value").data("value",n[String(m)][c]);var b=function(e,t){this.position={x:1150,y:0},i.call(this,e,this.position,t),this.initPosition()};(b.prototype=Object.create(i.prototype)).constructor=b.contructor,b.prototype.initPosition=function(){var e=$(".game5_content").height(),t=w(2,10);this.updateCss(),this.move(),this.position.y=0==t||1==t?0:5==t||6==t?e-this.size.height:2==t||3==t?e/3-this.size.height/3:4==t||7==t?e/2-this.size.height/2:60},b.prototype.move=function(){var t=this,i=setInterval(function(){if(t.position.x-=y.blockv,t.position.x<-t.size.width&&t.$el.remove(),t.updateCss(),y.gameTime>0&&t.collide1(g)&&(p-=20,$("#barr").attr("aria-valuenow",p).css("width",p+"%"),$("#hppp").html(p),t.$el.children("img").attr("src","img/cloud_v3.png"),t.$el.addClass("ooo"),clearInterval(i),$("#boxman_value").attr("src","img/boxman4.png"),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png")},200),setTimeout(function(){$("#boxman_value").attr("src","img/boxman4.png")},400),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png"),t.$el.remove()},600),logFile.push(s+"秒--------------\x3e撞到障礙物(c)\n"),logFileSimple.push("c"),db.ref(fullDbUrl+"Detail").push(s+"秒--------------\x3e撞到障礙物(c)"),p<=0&&y.gameLose()),y.gameTime>0&&t.collide2(g))if(TweenMax.to(t.$el,.1,{scale:0}),$("#boxman_value").data("value")===t.$el[0].attributes[2].value){clearInterval(i),$("#boxman_value").attr("src","img/boxman3.png"),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png")},200),setTimeout(function(){$("#boxman_value").attr("src","img/boxman3.png")},400),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png"),t.$el.remove()},600),m+=1,c=n[String(m)][4],o+=30,$("#game5_score").text(o),l++,$("#game5_topic").html(l),logFile.push(s+"秒--------------\x3e吸入氣球答題正確(y)\n"),logFileSimple.push("y"),db.ref(fullDbUrl+"Detail").push(s+"秒--------------\x3e吸入氣球答題正確(y)"),$("#boxman_value").data("value",n[String(m)][c]);var r=m+1;if($(".game5_question").html('<h5 style="font-weight: 700;">'+r+". "+a[m].title+"</h5>"),logFile.push("第"+(m+1)+"題\n"),db.ref(fullDbUrl+"Detail").push("第"+(m+1)+"題"),m===u){alert("第四關遊戲結束"),logFile.push("遊戲分數:"+o+"\n"),logFile.push("此關遊戲得分:"+(o-e)+"\n"),logFile.push("此關花費時間:"+(900-s)+"\n"),logFile.push("第四關遊戲結束-全部題目作答完(d)\n"),logFile.push("\n"),logFileSimple.push("d"),db.ref(fullDbUrl+"Detail").push("遊戲分數:"+o),db.ref(fullDbUrl+"Detail").push("此關遊戲得分:"+(o-e)),db.ref(fullDbUrl+"Detail").push("此關花費時間:"+(900-s)),db.ref(fullDbUrl+"Detail").push("第四關遊戲結束-全部題目作答完(d)"),db.ref(fullDbUrl+"Simple4").push(logFileSimple);for(var h=setInterval(";"),b=0;b<h;b++)clearInterval(b)}}else p-=20,clearInterval(i),t.$el.children("img").attr("src","img/cloud_v2.png"),$("#barr").attr("aria-valuenow",p).css("width",p+"%"),$("#hppp").html(p),logFile.push(s+"秒--------------\x3e吸入氣球答題錯誤(n)\n"),logFileSimple.push("n"),db.ref(fullDbUrl+"Detail").push(s+"秒--------------\x3e吸入氣球答題錯誤(n)"),p<=0?(logFile.push("遊戲分數:"+o+"\n"),logFile.push("此關遊戲得分:"+(o-e)+"\n"),logFile.push("第四關遊戲結束-沒血量(h)\n"),logFile.push("\n"),logFileSimple.push("h"),db.ref(fullDbUrl+"Detail").push("遊戲分數:"+o),db.ref(fullDbUrl+"Detail").push("此關遊戲得分:"+(o-e)),db.ref(fullDbUrl+"Detail").push("第四關遊戲結束-沒血量(h)"),db.ref(fullDbUrl+"Simple4").push(logFileSimple),y.gameLose()):($("#boxman_value").attr("src","img/boxman2.png"),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png")},200),setTimeout(function(){$("#boxman_value").attr("src","img/boxman2.png")},400),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png"),t.$el.remove()},600))},10)};var d=function(e,t){this.position={x:1150,y:0},i.call(this,e,this.position,t),this.initPosition()};(d.prototype=Object.create(i.prototype)).constructor=d.contructor,d.prototype.initPosition=function(){var e=$(".game5_content").height(),t=w(1,2);this.updateCss(),this.move(),this.position.y=1==t?e/3-this.size.height:e/2+this.size.height/2},d.prototype.move=function(){var e=this,t=setInterval(function(){e.position.x-=y.blockv,e.position.x<-e.size.width&&e.$el.remove(),e.updateCss(),y.gameTime>0&&e.collide1(g)&&(p-=20,$("#barr").attr("aria-valuenow",p).css("width",p+"%"),$("#hppp").html(p),e.$el.addClass("ooo"),clearInterval(t),$("#boxman_value").attr("src","img/boxman4.png"),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png"),e.$el.remove()},200),setTimeout(function(){$("#boxman_value").attr("src","img/boxman4.png")},400),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png")},600),logFile.push(s+"秒--------------\x3e撞到障礙物(c)\n"),logFileSimple.push("c"),db.ref(fullDbUrl+"Detail").push(s+"秒--------------\x3e撞到障礙物(c)"),p<=0&&y.gameLose()),y.gameTime>0&&e.collide2(g)&&(TweenMax.to(e.$el,.1,{scale:0}),clearInterval(t),$("#boxman_value").attr("src","img/boxman3.png"),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png")},200),setTimeout(function(){$("#boxman_value").attr("src","img/boxman3.png")},400),setTimeout(function(){$("#boxman_value").attr("src","img/boxman.png"),e.$el.remove()},600),r+=1,$("#game5_bonus_count").text(r),$("#game5_hp_btn").attr("disabled",!1),$("#game5_time_btn").attr("disabled",!1))},10)};var _=function(){this.btnControl(),this.createBlock(),this.createSupportBlock(),this.startGame(),this.startGameMain(),this.boxv=6,this.blockv=1,this.touch=!1,this.gameTime=360,this.isFalse=!1};function f(){var e=w(0,2);$(".pop__top > img").attr("src","img/pop_top.png"),$(".pop__top--text").html(popObj[e].text),$(".pop__link").attr("href",popObj[e].link),$(".pop").removeClass("hide")}function v(){$("#game5").css("display","none"),$("header").css("display","none"),1==pre_post_mode?($("#finalllllModal").modal({backdrop:"static",keyboard:!1}),db.ref(fullDbUrl+"Astep").set({step:2}),localStorage.setItem("Astep",2),pre_post_mode=2,logFile.push(logFileSimple.join("")),sessionStorage.setItem("logFile",JSON.stringify(logFile))):($("#finalModalMessage").html("所有測驗已結束\n</br>請通知主測者"),$("#finalModal").modal({backdrop:"static",keyboard:!1}),db.ref(fullDbUrl+"Astep").set({step:4}),localStorage.setItem("Astep",4),logFile.push(logFileSimple.join("")),save_a())}function x(){r<=0&&(r=0,$("#game5_bonus_count").text(r),$("#game5_hp_btn").attr("disabled",!0),$("#game5_time_btn").attr("disabled",!0))}_.prototype.btnControl=function(){var e=$(".game__btn"),t=this;e.on({mousedown:function(e){e.preventDefault(),t.boxv=6,t.touch=!0},mouseup:function(e){e.preventDefault(),t.boxv=6,t.touch=!1}})},_.prototype.startGame=function(){var t=this;setTimeout(function(){var i;i=setInterval(function(){s=t.gameTime,$(".game__time").text(t.gameTime),t.gameTime--,1==t.isFalse&&(clearInterval(i),console.log("lose")),330==t.gameTime&&$("#game5-notify-text").text("若吸入bonus，可使用圓形按鈕下方輔助功能。"),t.gameTime<0&&(t.gameSuccess(),clearInterval(i),logFile.push("遊戲分數:"+o+"\n"),logFile.push("此關遊戲得分:"+(o-e)+"\n"),logFile.push("第四關遊戲結束-時間到，題目未作答完(z)\n"),logFile.push("\n"),logFileSimple.push("z"),db.ref(fullDbUrl+"Detail").push("遊戲分數:"+o),db.ref(fullDbUrl+"Detail").push("此關遊戲得分:"+(o-e)),db.ref(fullDbUrl+"Detail").push("第四關遊戲結束-時間到，題目未作答完(z)"),db.ref(fullDbUrl+"Simple4").push(logFileSimple),v())},1e3)},500)},_.prototype.createBlock=function(){var e=26,t=0;setInterval(function(){var i=w(0,1);if(0==i)var o=$('<div class="block" id="'+e+'" data-value="'+n[String(m)][t]+'"><p>'+n[String(m)][t]+'</p><img src="img/cloud_v1.png"></div>');else var o=$('<div class="block" id="'+e+'" data-value="'+n[String(m)][t]+'"><p>'+n[String(m)][t]+'</p><img src="img/cloud_v1.png"></div>');$(".game5_content").append(o);new b({width:100,height:77},"#"+e);e++,4===++t&&(t=0)},3e3)},_.prototype.createSupportBlock=function(){var e=101,t=0;setInterval(function(){var i=w(0,1);if(0==i)var o=$('<div class="block" id="'+e+'" data-value="'+n[String(m)][t]+'"><img src="img/bonus.png"></div>');else var o=$('<div class="block" id="'+e+'" data-value="'+n[String(m)][t]+'"><img src="img/bonus.png"></div>');$(".game5_content").append(o);new d({width:75,height:75},"#"+e);e++,4===++t&&(t=0)},1e4)},_.prototype.startGameMain=function(){var e=this,t=setInterval(function(){e.touch&&($(".game__btn img").attr("src","img/btn2.png"),g.position.y-=e.boxv,e.boxv+=.6),e.touch||($(".game__btn img").attr("src","img/btn1.png"),g.position.y+=e.boxv,e.boxv+=.6),1==e.isFalse&&clearInterval(t),e.gameTime<0&&clearInterval(t),g.update()},30)},_.prototype.gameLose=function(){this.blockv=0,this.boxv=0,this.isFalse=!0,$("#boxman_value").attr("src","img/boxman5.png"),console.log("lose"),TweenMax.pauseAll(),$(".game__btn").css("pointer-events","none"),TweenMax.to(".game__boxman",.5,{y:"-=80px",x:"-=10px",rotation:-40,ease:Power1.easeOut,delay:.2}),TweenMax.to(".game__boxman",.6,{y:"+=800px",ease:Power1.easeIn,delay:.7,onComplete:v})},_.prototype.gameSuccess=function(){this.blockv=0,this.boxv=0,console.log("success"),TweenMax.pauseAll(),$(".block").remove(),$(".game__btn").css("pointer-events","none"),TweenMax.to(".game__boxman",3,{y:"+=40",ease:Elastic.easeOut.config(1,.3),delay:1}),TweenMax.to(".game__boxman",.5,{x:800,ease:Power1.easeIn,delay:2.5,onComplete:f})},$("#finalModal").on("click",function(){save_a()}),$("#game5_hp_btn").on("click",function(){logFile.push(s+"秒--------------\x3e補血+30按鈕(p)\n"),logFileSimple.push("p"),db.ref(fullDbUrl+"Detail").push(s+"秒--------------\x3e補血+30按鈕(p)"),r>0&&(r-=1,(p+=30)>=100&&(p=100),$("#barr").attr("aria-valuenow",p).css("width",p+"%"),$("#hppp").html(p)),x()}),$("#game5_time_btn").on("click",function(){logFile.push(s+"秒--------------\x3e時間+30秒按鈕(t)\n"),logFileSimple.push("t"),db.ref(fullDbUrl+"Detail").push(s+"秒--------------\x3e時間+30秒按鈕(t)"),r>0&&(r-=1,y.gameTime+=30,$(".game__time").text(y.gameTime)),x()}),$(".btn__reload").on("click",function(){location.reload()});var y=new _;function w(e,t){return Math.floor(Math.random()*(t-e+1))+e}$("#hppp").html(p)}()})}